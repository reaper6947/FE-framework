function e(t){const{type:n}=t;switch(n){case a.TEXT:!function(e){const{el:t}=e;t.remove()}(t);break;case a.ELEMENT:!function(t){const{el:n,children:s,listeners:r}=t;n.remove(),s.forEach(e),r&&(!function(e={},t){Object.entries(e).forEach((([e,n])=>{t.removeEventListener(e,n)}))}(r,n),delete t.listeners)}(t);break;case a.FRAGMENT:!function(t){const{children:n}=t;n.forEach(e)}(t);break;default:throw new Error(`Can't destroy DOM of type: ${n} `)}delete t.el}class t{#e=new Map;#t=[];subscribe(e,t){this.#e.has(e)||this.#e.set(e,[]);const n=this.#e.get(e);return n.includes(t)?()=>{}:(n.push(t),()=>{const e=n.indexOf(t);n.splice(e,1)})}afterEveryCommand(e){return this.#t.push(e),()=>{const t=this.#t.indexOf(e);this.#t.splice(t,1)}}dispatch(e,t){this.#e.has(e)?this.#e.get(e).forEach((e=>e(t))):console.warn(`No handlers for command: ${e}`),this.#t.forEach((e=>e()))}}function n(e,t){const{class:n,style:r,...c}=t;n&&function(e,t){e.className="","string"==typeof t&&(e.className=t);Array.isArray(t)&&e.classList.add(...t)}(e,n),r&&Object.entries(r).forEach((([t,n])=>{!function(e,t,n){e.style[t]=n}(e,t,n)}));for(const[t,n]of Object.entries(c))s(e,t,n)}function s(e,t,n){null==n?function(e,t){e[t]=null,e.removeAttribute(t)}(e,t):t.startsWith("data-")?e.setAttribute(t,n):e[t]=n}function r(e,t){switch(e.type){case a.TEXT:!function(e,t){const{value:n}=e,s=document.createTextNode(n);e.el=s,t.append(s)}(e,t);break;case a.ELEMENT:!function(e,t){const{tag:s,props:c,children:o}=e,a=document.createElement(s);(function(e,t,s){const{on:r,...c}=t;s.listeners=function(e={},t){const n={};return Object.entries(e).forEach((([e,s])=>{const r=function(e,t,n){return n.addEventListener(e,t),t}(e,s,t);n[e]=r})),n}(r,e),n(e,c)})(a,c,e),e.el=a,o.forEach((e=>r(e,a))),t.append(a)}(e,t);break;case a.FRAGMENT:!function(e,t){const{children:n}=e,s=document.createDocumentFragment();e.el=t,n.forEach((e=>r(e,s))),t.append(s)}(e,t);break;default:throw new Error(`Can't mount DOM of type: ${e.type} `)}}function c(e){return e.filter((e=>null!=e))}function o(e){return e.map((e=>"string"==typeof e?f(e):e))}const a={ELEMENT:"element",TEXT:"text",FRAGMENT:"fragment"};function i(e,t={},n=[]){return{tag:e,props:t,children:o(c(n)),type:a.ELEMENT}}function u(e){return{children:o(c(e)),type:a.FRAGMENT}}function f(e){return{type:a.TEXT,value:e}}function l({state:n,view:s,reducers:c={}}){let o=null,a=null;const i=new t,u=[i.afterEveryCommand(l)];function f(e,t){i.dispatch(e,t)}for(const e in c){const t=c[e],s=i.subscribe(e,(e=>{n=t(n,e)}));u.push(s)}function l(){a&&e(a),a=s(n,f),r(a,o)}return{mount(e){o=e,l()},unmount(){e(a),a=null,u.forEach((e=>e()))}}}export{a as DOM_TYPES,l as createApp,i as h,u as hFragment,f as hString,c as withoutNulls};
